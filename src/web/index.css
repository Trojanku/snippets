@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-paper: 245 242 236;
  --color-paper-deep: 236 231 222;
  --color-ink: 33 31 28;
  --color-ink-soft: 103 97 90;
  --color-line: 206 198 184;
  --color-line-strong: 176 166 150;
  --color-focus: 71 85 105;
  --color-accent: 100 116 139;
  --color-accent-soft: 226 232 240;
  --color-danger: 174 89 75;
  --color-danger-soft: 247 231 226;
  --color-caution: 195 150 95;
  --color-success: 58 111 76;
}

html.light {
  color-scheme: light;
}

html.dark {
  --color-paper: 19 22 24;
  --color-paper-deep: 14 16 18;
  --color-ink: 236 234 228;
  --color-ink-soft: 171 166 157;
  --color-line: 62 65 69;
  --color-line-strong: 91 95 100;
  --color-focus: 165 180 200;
  --color-accent: 148 163 184;
  --color-accent-soft: 30 41 59;
  --color-danger: 211 120 102;
  --color-danger-soft: 56 33 29;
  --color-caution: 220 173 114;
  --color-success: 122 188 145;
  color-scheme: dark;
}

@media (prefers-color-scheme: dark) {
  html:not(.light) {
    --color-paper: 19 22 24;
    --color-paper-deep: 14 16 18;
    --color-ink: 236 234 228;
    --color-ink-soft: 171 166 157;
    --color-line: 62 65 69;
    --color-line-strong: 91 95 100;
    --color-focus: 165 180 200;
    --color-accent: 148 163 184;
    --color-accent-soft: 30 41 59;
    --color-danger: 211 120 102;
    --color-danger-soft: 56 33 29;
    --color-caution: 220 173 114;
    --color-success: 122 188 145;
  }
}

@layer base {
  * {
    @apply box-border m-0;
  }

  html,
  body,
  #root {
    min-height: 100%;
  }

  body {
    @apply font-sans text-ink leading-1.6 antialiased transition-colors duration-200;
    background-color: rgb(var(--color-paper));
    background-image:
      radial-gradient(circle at 0% -10%, rgba(var(--color-accent), 0.2) 0, transparent 35%),
      radial-gradient(circle at 100% 92%, rgba(var(--color-line-strong), 0.18) 0, transparent 42%),
      linear-gradient(140deg, rgba(var(--color-paper), 1), rgba(var(--color-paper-deep), 0.82));
  }
}

@layer components {
  .panel {
    @apply border border-line/65 rounded-2xl bg-paper/80 backdrop-blur;
    box-shadow: 0 12px 28px rgba(12, 14, 16, 0.06);
  }

  .panel-subtle {
    @apply border border-line/55 rounded-xl bg-paper-deep/20;
  }

  .panel-rail {
    @apply bg-paper/50;
    box-shadow: 0 8px 24px rgba(10, 11, 12, 0.05);
  }

  .surface {
    @apply panel p-4;
  }

  .stream-surface {
    @apply bg-paper/75;
    box-shadow: 0 18px 38px rgba(11, 12, 13, 0.09);
  }

  .stream-shell {
    @apply rounded-3xl border border-line/60 bg-paper/60 p-3;
    box-shadow: 0 18px 42px rgba(8, 9, 10, 0.08);
  }

  .stream-header {
    @apply mb-3 flex flex-wrap items-center justify-between gap-3 border-b border-line/55 pb-2;
  }

  .stream-grid {
    @apply grid gap-3 md:grid-cols-[280px_minmax(0,1fr)];
  }

  .stream-grid-focus {
    @apply md:grid-cols-1;
  }

  .stream-rail {
    @apply flex min-h-[460px] flex-col rounded-2xl border border-line/55 bg-paper/30 p-3;
  }

  .control {
    @apply border border-line/70 bg-paper/70 rounded-lg px-3 py-2 text-sm text-ink transition-colors;
  }

  .control:hover {
    @apply border-line-strong/90 bg-paper;
  }

  .control::placeholder {
    color: rgb(var(--color-ink-soft) / 0.7);
  }

  .btn {
    @apply rounded-full border px-3 py-1.5 text-xs tracking-widest uppercase transition-colors;
  }

  .btn-muted {
    @apply btn border-line/70 bg-paper/45 text-ink-soft hover:border-line hover:bg-paper hover:text-ink;
  }

  .btn-accent {
    @apply btn border-line-strong bg-accent-soft text-ink hover:border-focus;
  }

  .chip {
    @apply text-xs rounded-full px-2 py-0.5 tracking-widest uppercase border border-line bg-paper-deep/60 text-ink-soft;
    font-size: 10px;
  }

  .status {
    @apply text-xs tracking-widest uppercase px-2 py-0.5 rounded-full border;
    font-size: 10px;
  }

  .status-raw {
    @apply bg-paper-deep/70 text-ink-soft border-line;
  }

  .status-processed {
    @apply bg-accent-soft/80 text-success border-success/30;
  }

  .status-queued {
    @apply bg-paper/90 text-ink-soft border-line;
  }

  .status-processing {
    @apply text-ink-soft border-line;
    background: linear-gradient(
      90deg,
      rgba(var(--color-paper), 0.9),
      rgba(var(--color-accent-soft), 0.7),
      rgba(var(--color-paper), 0.9)
    );
    background-size: 200% 100%;
    animation: mist-shift 3s ease-in-out infinite;
  }

  .status-failed {
    @apply bg-danger-soft text-danger border-danger/40;
  }

  .badge {
    @apply chip;
  }

  .action-clear {
    @apply text-success border-success/35 bg-accent-soft/70;
  }

  .action-maybe {
    @apply text-caution border-caution/35 bg-caution/10;
  }

  .note-row {
    @apply flex flex-col gap-2 py-4 px-3 text-left w-full text-ink border-b border-line/60 transition-colors rounded-lg;
  }

  .note-row:hover {
    @apply bg-paper/65;
  }

  .stream-note-row {
    @apply w-full rounded-xl border border-line/45 bg-paper/20 px-3 py-3 text-left transition-colors;
  }

  .stream-note-row:hover {
    @apply border-line-strong/90 bg-paper/60;
  }

  .stream-note-row-active {
    @apply border-line-strong bg-accent-soft/55;
    box-shadow: inset 0 0 0 1px rgba(var(--color-line-strong), 0.14);
  }

  .stream-editor {
    @apply flex flex-col rounded-2xl bg-paper/10 p-1;
  }

  .note-title-input {
    @apply w-full rounded-lg border border-transparent bg-transparent px-1 py-0.5 font-serif text-[clamp(1.8rem,4vw,2.6rem)] font-semibold leading-[1.1] text-ink transition-colors;
  }

  .note-title-input:hover {
    @apply border-line/55 bg-paper/25;
  }

  .stream-writer-surface {
    @apply rounded-2xl bg-transparent p-0;
    box-shadow: none;
  }

  .stream-writer-surface-rich {
    @apply bg-transparent;
  }

  .stream-editor-pane {
    @apply min-w-0;
  }

  .stream-textarea {
    @apply min-h-[44vh] max-h-[58vh] w-full resize-y rounded-xl border border-line/35 bg-paper/95 px-4 py-3 font-serif text-[18px] leading-[1.8] text-ink;
  }

  .stream-textarea:hover {
    @apply border-line/55;
  }

  .stream-textarea::placeholder {
    color: rgb(var(--color-ink-soft) / 0.65);
  }

  .rich-editor-shell {
    @apply rounded-xl border border-transparent bg-transparent;
  }

  .rich-editor-body {
    @apply relative;
  }

  .rich-editor-placeholder {
    @apply pointer-events-none absolute left-5 top-4 text-base text-ink-soft;
  }

  .rich-editor-content {
    @apply min-h-[44vh] max-h-[58vh] overflow-y-auto px-3 py-2 font-serif text-[18px] leading-[1.8] text-ink;
    outline: none;
  }

  .rich-editor-content p {
    margin: 0 0 0.6em;
  }

  .rich-editor-content h1,
  .rich-editor-content h2,
  .rich-editor-content h3 {
    @apply font-serif leading-tight text-ink;
    margin: 1em 0 0.45em;
  }

  .rich-editor-content h1 {
    font-size: 1.6em;
  }

  .rich-editor-content h2 {
    font-size: 1.35em;
  }

  .rich-editor-content h3 {
    font-size: 1.15em;
  }

  .rich-editor-content ul,
  .rich-editor-content ol {
    margin: 0 0 0.8em;
    padding-left: 1.35em;
    list-style-position: outside;
  }

  .rich-editor-content ul {
    list-style-type: disc;
  }

  .rich-editor-content ol {
    list-style-type: decimal;
  }

  .rich-editor-content li::marker {
    color: rgb(var(--color-ink-soft));
  }

  .rich-editor-content blockquote {
    @apply border-l-2 border-line pl-3 text-ink-soft;
    margin: 0 0 0.8em;
  }

  .rich-editor-content code {
    @apply rounded bg-paper-deep/80 px-1 py-0.5;
    font-size: 0.85em;
  }

  .rich-editor-content pre {
    @apply overflow-x-auto rounded-lg border border-line/60 bg-paper-deep/65 px-3 py-2;
    margin: 0 0 0.8em;
  }

  .rich-editor-content a {
    @apply text-focus underline underline-offset-2;
  }

  .note-content p,
  .note-content ul,
  .note-content ol,
  .note-content blockquote {
    margin: 0 0 1.05em;
  }

  .note-content h1,
  .note-content h2,
  .note-content h3,
  .note-content h4 {
    @apply font-serif leading-tight;
    margin: 1.2em 0 0.6em;
  }

  .note-content code {
    @apply bg-paper-deep/80 px-1 py-0.5 rounded;
    font-size: 0.86em;
  }

  .note-content a {
    @apply text-focus;
  }

  .action-result-content p,
  .action-result-content ul,
  .action-result-content ol,
  .action-result-content blockquote {
    margin: 0 0 0.7em;
  }

  .action-result-content ul,
  .action-result-content ol {
    padding-left: 1.2rem;
  }

  .action-result-content code {
    @apply bg-paper-deep/80 px-1 py-0.5 rounded;
    font-size: 0.85em;
  }

  .action-result-content pre {
    @apply rounded-md border border-line/70 bg-paper/60 p-2 overflow-x-auto;
  }

  .action-result-content a {
    @apply text-focus underline underline-offset-2;
  }

  .tree-node {
    @apply space-y-1;
  }

  .tree-branch {
    @apply ml-4 border-l border-line/40 pl-3;
  }

  .tree-toggle {
    @apply h-7 w-7 min-w-7 rounded-md border border-line/55 bg-paper/30 text-xs leading-none text-ink-soft transition-colors hover:border-line-strong hover:bg-paper hover:text-ink;
  }

  .tree-folder {
    @apply flex-1 rounded-lg border px-2.5 py-1.5 text-left text-sm transition-colors;
  }

  .tree-folder-idle {
    @apply tree-folder border-transparent text-ink-soft hover:border-line/70 hover:bg-paper/65 hover:text-ink;
  }

  .tree-folder-active {
    @apply tree-folder border-line-strong bg-accent-soft/80 text-ink;
  }

  .tree-pill {
    @apply min-w-[2rem] rounded-full border px-1.5 py-1 text-center text-[11px] leading-none;
  }

  .tree-pill-idle {
    @apply tree-pill border-line bg-paper/70 text-ink-soft;
  }

  .tree-pill-active {
    @apply tree-pill border-line-strong bg-accent-soft text-ink;
  }

  .folder-row {
    @apply flex w-full items-center gap-2 rounded-lg border px-2 py-1.5 text-left transition-colors;
  }

  .folder-row-shell {
    @apply flex items-center gap-1;
  }

  .folder-toggle {
    @apply h-7 w-7 min-w-7 rounded-md border border-line/55 bg-paper/35 text-xs leading-none text-ink-soft transition-colors hover:border-line-strong hover:bg-paper hover:text-ink disabled:cursor-default disabled:opacity-50;
  }

  .folder-row-idle {
    @apply border-transparent text-ink-soft hover:border-line/70 hover:bg-paper/65 hover:text-ink;
  }

  .folder-row-active {
    @apply border-line-strong bg-accent-soft/80 text-ink;
  }

  .folder-children {
    @apply mt-1 flex flex-col gap-1;
  }

  .folder-note-row {
    @apply w-full truncate rounded-md border border-transparent py-1.5 pr-2 text-left text-sm text-ink-soft transition-colors hover:border-line/65 hover:bg-paper/65 hover:text-ink;
  }

  .folder-note-row-active {
    @apply border-line/80 bg-paper/65 text-ink;
  }

  .folder-menu {
    @apply absolute z-40 min-w-40 rounded-lg border border-line/70 bg-paper/95 p-1 shadow-lg;
  }

  .folder-menu-item {
    @apply w-full rounded-md px-2.5 py-1.5 text-left text-sm text-ink transition-colors hover:bg-paper-deep/70;
  }

  .folder-menu-item.danger {
    @apply text-danger hover:bg-danger-soft;
  }
}

@layer utilities {
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    @apply outline-2 outline-offset-2;
    outline-color: rgb(var(--color-focus));
  }
}

@keyframes mist-shift {
  0% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }

  100% {
    background-position: 0% 50%;
  }
}
